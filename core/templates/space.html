{% extends "base.html" %}

{% block core %}

	{% include "views/view_space.html" %}

	<div class="popup-bg"></div>
	<div class="popup" id="popupEditSpace">
		<button class="popup_btn-close">Zamknij</button>
		<h2>Edytuj przestrzeń</h2>
		<div id="editForm">
			{% include "forms/form_edit_space.html" %}
		</div>
	</div>
	<div class="popup" id="popupNewSpace">
		<button class="popup_btn-close">Zamknij</button>
		<h2>Dodaj przestrzeń</h2>
		<div id="newSpaceForm">
			{% include "forms/form_new_space.html" %}
		</div>
	</div>
	<div class="popup" id="popupAddCollaborators">
		<button class="popup_btn-close">Zamknij</button>
		<h2>Dodaj użytkowników</h2>
		<div id="addCollaboratorsForm">
			{% include "forms/form_add_collaborators.html" %}
		</div>
	</div>

	<div style="position: absolute; bottom: 0; display: flex; justify-content: space-between; width: 1100px;">
		<div style="display: flex;"></div><div id="log" style="background:yellow; width: 300px; padding: 10px;"></div>
	</div>

<script type="text/javascript">

    var ws;
    init();

    function init() {

      // Connect to Web Socket
      ws = new WebSocket("ws://localhost:9001/");

      // Set event handlers.
      ws.onopen = function() {
        output("onopen");
        ws.send("{{request.session.session_key}}");
      };

      ws.onmessage = function(e) {
        // e.data contains received string.
        output("onmessage: " + e.data);
      };

      ws.onclose = function() {
        output("onclose");
      };

      ws.onerror = function(e) {
        output("onerror");
        console.log(e)
      };

    }

    function onSubmit() {
      var input = document.getElementById("input");
      // You can send message to the Web Socket using ws.send.
      ws.send(input.value);
      output("send: " + input.value);
      input.value = "";
      input.focus();
    }

    function onCloseClick() {
      ws.close();
    }

    function output(str) {
      var log = document.getElementById("log");
      var escaped = str.replace(/&/, "&amp;").replace(/</, "&lt;").
        replace(/>/, "&gt;").replace(/"/, "&quot;"); // "
      log.innerHTML = escaped + "<br>" + log.innerHTML;
    }

  </script>

	<script src="/static/js/space.js"></script>
{% endblock %}
